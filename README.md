##### به نام خدا

## ناهید ازادی چگنی

## 40211415002 شماره دانشجوی:

## استاد : دکتر ارمین رشنو

## و داده حجیم موضوع : تمرین کلاسی پردازش موازی


ی دارم که نقطه mainکردم و یه فایل importکه تمام صفحه هامو داخلش configاولین مرحله اومدم یه فایل درست کردم به اسم
اتصال رو اونجا قرار دادم.
![تصویر نمونه](images/screenshot.png)

configفایل
```

mainفایل

##### در این مرحله یکی یکی تمرین هارو قرار می دهیم.

```
هاthread
```

##### این تمرین اول ما می باشد که ما باید خروجی جیسون را ایجاد کنیم براش و یکی یکی سناریو ها رو قرار میدهم.

##### سناریو اول:

#### هم براش ایجاد کردم. basemodelومدم ایمپورت های که نیاز هست رو انجام دادم و یک کلاس توی این مرحله ا


#### توی این سناریو خروجی مورد نظری که توی تمرین ازمون خواسته بود رو ایجاد کردم با خروجی جیسون که توی این کد

#### ایجاد کردم از کلاس ترد که یک تارگت و یک تا اجرا میشه داخل این حلقه یک شی 10 ار دادم که توی رنج یه حلقه قر

#### می باشد که خروجی های مورد نظر ما رو به یک لیست اضافه میکند my_func_wrapperارگمان می گیرد که تارگت

#### که چاپ بشن.



#### سناریو دوم :

#### ولید بشه توی این سنارو گفتم اول فرد هارو برام نمایش بده بعد زوج هارو که خروجی متفاوت برای ما ت


#### های تولید شده توسط هر رشته را ذخیره کندکند تا پیامایجاد میoutputs این خط یک لیست خالی به نام : outputs = []

```
:def my_func_wrapper(thread_number)
```
کند تا یک پیام تولید نی میرا با شماره رشته فراخوا my_func گیرد، سپس ی رشته را به عنوان آرگومان میاین تابع کمکی شماره
شود، در غیر این صورت، پیام به ابتدای لیست اضافه اضافه می outputs شود. اگر شماره رشته زوج باشد، پیام به انتهای لیست
.شودمی

```
:forتوی حلقه ی
```
```
اره رشته مربوطه فراخوانی را با شم my_func_wrapper ها تابع کند و هر کدام از آنرشته ایجاد می 10 ،هم این قسمت کد
.کندکند. سپس هر رشته شروع به کار میمی
```
#### ها کار خود را به پایان برسانندی رشتهماند تا همهاین حلقه منتظر می پاینی : forتوی قسمت

#### .گرداندها است، برمیهای تولید شده توسط رشتهرا که شامل پیام outputs این خط لیست :return outputs



##### سناریو سوم :


بهش گفتم که معکوس رو برام انجام بده for توی این سناریو هم توضیحات مثل سناریو های قبلی می باشد فقط اومدم جلوی حلقه

. که خروجی متفادت تولید بشه برام یعنی برعکس کنه رشته هارو



##### تمرین دوم :

#### .


#### سناریو اول:

##### ی هر تابع یک لیست درست کردم که وضعیت اجراش توی اون ذخیره بشه بعد اومدم تابع هارو تعریف کردم توی این عکس ما برا

##### که توی این توابع عملکردشون رو توی اون لیست ذخیره می کنند.


##### و جوین می شوند به ترتیب خواسته شده .که استارت توی این هم اومدم رشته هارو درست کردم


function_A, این قطعه کد بخشی از تابعی است که نتایج خروجی سه تابعقرار دارد. return دم جای که توی این قسمت اوم
های جداگانه گرداند. هر یک از این توابع در رشتهبرمی (dictionary) را در یک دیکشنریfunction_c و function_B,
کنند. سپس این ذخیره می (output_A, output_B, output_C) های سراسریشوند و وضعیت خود را در لیستاجرا می
که مقدار و اونای اونای که مقار صفر دارن یعنی خروجی اولی که .شودبه کلاینت بازگردانده می HTTP دیکشنری به عنوان پاسخ
یک دارن یعنی خروجی دومی.


##### رو تغیر داده ایم .که خروجی متفاوت تولید شود هم مثل هون اولی می باشد ترتیب استارت و جوین ها سوم و دوم سناریو

#### خروجی سناریو دوم


#### خروجی سناریو سوم

#### .

## تمرین سوم:


## سناریو اول:


## از نوع رشته message فیلد درست کردم که یک مدل ساده می باشد که ThreadOutput توی این مرحله اومدم یک کلاس

```
.را در خود دارد شودها استفاده میهای تولید شده توسط رشتهداری پیاماست که برای نگه(string)
```
```
برای مقداردهی __init__ : ارث بری میکنه و دو مقدار هم داره threading.Threadهم دارم که از mythredو یک کلاس
صلی رشته که شامل افزودن پیام شروع، برای اجرای عملیات ا run و .شوندها در آن ذخیره میاولیه نام رشته و لیستی که پیام
.ت استفاده میشود ثانیه و افزودن پیام پایان اس 1 انتظار به مدت
```

##### توی این دوتا عکس هم اومدم رشته هارو ایجاد کردم نام رو هم به اونا اختصاص دادم دوتا حلقه گذاشتم برای استارت و جوین شدن

##### ها را محاسبه کرده و آن را به عنوان یک پیام به لیست کد مدت زمان کل اجرای رشته این بخش ازو قسمت پاینی اون هر کدام


##### همان پیغام پایانی توی ها چقدر زمان برده استدهد که بدانید اجرای تمامی رشتهکند. این کار به شما امکان میخروجی اضافه می

##### خروجی می باشد.

##### ی که خواسته شده درست کردم توی سناریو اول من خروجی رو مطابق با اون چیز



##### سناریو دوم:

##### ه توی این سناریو اومدم پیام استارت و پایان رو برای هر رشته زیر هم قرار دادم یعنی استارت میشه پیام راچاپ میکنه و تمام میش

##### میشه. کوچک به بزرگ پیام های آن ها چاپ پیام پایان رو چاپ میکنه توی این رشته ها از


##### ش رشته رو که گرفتی استارت شد جوین رو هم پشت سرش انجام بده .گفتم به



##### سناریو سوم:

##### اجرا و 9 بهش گفتم به صورت نزولی پیام های مربوط به استارت و پایان اون هارو نمایش بهم بده یعنی اول رشته توی این سناریو

##### اجرا و پایان به همین صورت. 8 پایان یعد رشته


##### د نظر را قرار میدهیم.که خروجی مور



##### تمرین چهارم:


##### سناریو اول :

##### بالا به همین صورت .ین چاپ میکنه یکی از یتوی این سناریو بهش گفتم از داخلی ترین ترد شروع کنه و یکی از پا


و شماره رشته thread_number این کلاس یک مدل ساده با دو فیلد که درست کردم ThreadOutputاول اومدم یه کلاس
.شودها استفاده میهای تولید شده توسط رشتهاست که برای نگهداری پیام پیامmessage

. init,runارث بری میکنه و دو متد داره threading.Threadاز که این کلاس MyThreadیک کلاس هم درست کردم به اسم

```
استفاده میشه. شوندها در آن ذخیره میو لیستی که پیام (lock) رشته، لاک مقداردهی اولیه نام رشته، شماره برای init که
```
```
ثانیه، و افزودن پیام پایان است. از لاک 1 اجرای عملیات اصلی رشته که شامل افزودن پیام شروع، انتظار به مدت هم برای runو
ک قفل را میگیرد و پیام هارو چاپ میکنه بعد ازاد میکنه قفل که در این تابع لا.کندبرای اطمینان از اجرای همزمان امن استفاده می
رو.
```

```
شه.استفاده می (threads) هاهای تولید شده توسط رشتهاین لیست برای نگهداری پیام : output_list = []
```
```
نابع مشترک در اینجا تا دسترسی به م شه ایجاد می (concurrency) یک لاک برای کنترل همزمانی : lock = threading.Lock()
بشه.به صورت ایمن انجام output_list
```
```
بشه.ها محاسبه تا در نهایت مدت زمان کل اجرای رشته هشها ثبت میزمان شروع اجرای رشته : start_time = time.time()
```
```
: threads = [ MyThread(f"Thread#{i+ 1 }", i+ 1 , lock, output_list) for i in range( 9 )]
```
و (Thread#1, Thread#2, ...) فرد. هر رشته با نام منحصربههشایجاد می MyThread رشته از نوع 9 ست شامل یک لی
دسترسی (output_list) و لیست خروجی (lock) شود. همچنین هر رشته به لاکمقداردهی اولیه می (i+ 1 ) ی مربوطهشماره
ه.دار


ای است که ابتدا از مرکز لیست شروع کرده و به صورت متناوب به به گونه (threads)هاسازی رشتهاین بخش از کد مسئول مرتب
.تری اجرا شوندی زمانی مناسبتر و با فاصلهها به صورت متوازنشود که رشتهکند. این کار باعث میچپ و راست حرکت می




##### سناریو دوم :

##### . توضیحات مثل قبلی است دیگه از تو ضیحات چاپ میکنه یا رشته ها رو م میاد از کوچیک به بزرگ ترد هاتوی این سناریو ه

##### اضافه اجتناب میشه.



##### خروجی کد:




##### : توی این سناریو هم گفتم به صورت نزولی بیاد چاپ کند خروجی هارو. سناریو سوم



اومدم مقدار لیست را برعکس کرده ایم output_list.sortدر قسمت

##### خروجی:




##### تمرین پنجم:


##### سناریو اول :

##### توی این سناریو من اومدم خروجی مورد نظر که ازم خواسته بود رو تولید کرده ام.


```
تا تابع رو توی خودش داره که به شرح هر کدوم می پردازیم. 4 درست کردیم که boxما یک کلاس
```
```
:initتابع
```
#### ها است که به یک یک نوع خاص از قفل. RLock شودایجاد می (threading.RLock) قفل مجددپذیر self.lock

#### .ددهد که قفل را چندین بار بگیررشته این امکان را می

#### .هستش 0 که مقدار اولیه آن Box ای برای نگهداری تعداد اقلام در شمارنده self.total_items

#### : executeتابع

#### ، هیچ رشته دیگری total_itemsکه هنگام اجرای تغییرات بر روی هکنیاطمینان حاصل م with self.lock

#### .قفل گرفته شده چون ،هبه این بخش از کد دسترسی پیدا کن نهتونمی

#### مثبت value. اگر هکنتغییر می value بر اساس total_items مقدار self.total_items += value

#### پیدا میکنه.، کاهش هو اگر منفی باش نهپیدا میکافزایش total_items ،هباش

#### :addتابع

#### هشاستفاده می total_items این متد برای افزودن یک واحد به

#### این بخش تواند بهکند که تنها یک رشته در هر زمان می، اطمینان حاصل میexecuteهمانند متد with self.lock

#### ه از کد دسترسی داشته باش

#### :removeمتد

#### .هشستفاده میا total_items این متد برای کاهش یک واحد از

#### .بشهکه تغییرات به صورت ایمن و همزمان انجام هکن، اطمینان حاصل میaddهمانند متد with self.lock:


#### ذخیره میشه. های مربوط به عملیاتلیستی برای نگهداری نتایج و پیام Results[]

#### یا ترد ها هاهنگی بین رشتهقفلی برای هما : lock

نه.باید شروع شود یا (removing) برای نشان دادن اینکه آیا عملیات حذف (flag) یک فلگ remove_started
استفاده remove_started و results گوید که از متغیرهای این خط به پایتون می :nonlocal results, remove_started
ند.اتر تعریف شدهکند که در سطح بیرونی

#### همان ایتم های که از بدنه هایی است که باید به جعبه اضافه شونددر کد به معنای استخراج تعداد آیتم : items = request.items

##### تو اینسمنیا بهش می فرستم.

```
شودپیام شروع عملیات افزودن به لیست نتایج اضافه می :results.append(f"N° {items} items to ADD)
```
#### :شودباشد اجرا می 0 بزرگتر از items تا زمانی که while حلقه

#### .کندیک آیتم به جعبه اضافه می : box.add()

#### .کندیک ثانیه صبر می : time.sleep( 1 )

#### .دهدمانده برای افزودن را کاهش میهای باقیتعداد آیتم : items -= 1

#### پیام افزودن یک آیتم به :results.append(f"ADDED one item -->{items} item(s) to ADD")

#### .شودلیست نتایج اضافه می

#### :کند که آیا عملیات حذف باید شروع شودبا استفاده از قفل، بررسی می

#### باشد حذف کردن ترو می شود و شروع به کار میکند. box.total_items > 0 یک حلقه قرار داده شده که اگر مقدار

#### 


هابه صورت همزمان با سایر رشته (Box) کند که مسئول حذف اقلام از جعبهرا تعریف می remover ابعی به نام این کد ت
.شودکند تا اطمینان حاصل شود که عملیات حذف به صورت ایمن انجام میاست. این تابع از قفل استفاده می(threads)

```
ید حذف شوند.: نشان دهنده تعداد ایتم های است که باitems = 1
```
```
بعد پیامی چاپ می شود بعد از آن یه حلقه قرار داده شده که اگر مقدار بزرگتر از صفر بود ان را حذف کند.
```

رساند و را به پایان می start_operations این خط کد، تابع :return {"status": "success", "results": results}
گرداند. در واقع، این خط یک شیء دیکشنری شامل وضعیت و نتایج عملیات را خ به کلاینت برمیی عملیات را به عنوان پاسنتیجه
.گرداندبازمی

##### خروجی:

##### سناریو دوم:


```
استفاده میشه. post این تابع برای پردازش این درخواست :def start_operations(request: OperationRequest)
```
#### .ها استبرای اعتبارسنجی ورودی Pydantic است که یک مدلOperationRequest از نوع :request

#### .شودهای خروجی استفاده مییک لیست خالی که برای ذخیره پیام : results

#### همون ورودی که بهش دادم شودهایی که باید اضافه شوند، از درخواست استخراج میتعداد آیتم : items_to_add

#### هر چند تای که بود.

#### .شوددر هر تکرار، یک آیتم به جعبه اضافه می. کندشمارش می 0 تا items_to_add این تابع یک حلقه دارد که از

#### : removتلبع

#### .شوددر هر تکرار، یک آیتم از جعبه حذف می. کندشمارش می items_to_add تا 0 این تابع یک حلقه دارد که از

#### .دهد چند آیتم باقی مانده است تا حذف شوندد که نشان میشواضافه می results یک پیام به


#### خروجی:



#### سناریو سوم:


#### خروجی:



#### تمرین ششم:


#### توی این سناریو دقیقا همه خروجی تولید میشه تولید کننده تولید میکنه مصرف کننده مصرف میکنه .سناریو اول:



#### خروجی:


#### وم: سناریو د

#### توی این سناریو اومدم جوین هارو برداشتم تا عملکرد کد رو تست کنم که توی این سناریو فقط مصرف کننده چاپ

#### میشه و به حالت انتضار می رود.



#### تمرین هفتم:


#### سناریو اول:

##### هد. در این مسابقه، دوندگان با تأخیر مشخصی شروع به دسازی ساده از یک مسابقه با سه دونده را انجام میاین کد یک شبیه

##### مانند تا همه دوندگان دیگر نیز برسند. سپس رسند و منتظر میکنند و در نهایت همگی به یک نقطه (خط پایان) میحرکت می

#### .شوندنتایج ثبت و چاپ می

```
ت دوندگان و تعریف ایست نتایج .و تعریف لیس سازیبرای هماهنگBarrier تعریف تعداد دوندگان و ایجاد یک
```
تر، این تابع هر دونده سازی رفتار یک دونده در مسابقه را بر عهده دارد. به طور دقیقدر کد وظیفه شبیه runner این تابع
.کندکند و سپس رفتار او را هنگام رسیدن به خط پایان ثبت میسازی میرا با نام و تأخیر مشخصی مدل


```
این توضیحات مال خط های کالا کندرا برای هر مسابقه تنظیم مجدد میBarrier لیست دوندگان، لیست نتایج و این قسمت
حلقه است.
```
```
تاخیر های برا سه شرکت کننده تعریف شده است مثلا یکی یک ثانیه یکی دو ثانیه یکی سه ثانیه به همین صورت ifتوی قسمت
تا بود از تاخیر های که به 3 بت تاخیر رندم هم قرار دهیم ما اینجا گفته ایم اگر تعداد ما می توانیم به جای این تاخیر های ثا
صورت ثابت گذاشتم استفاده کن اگر نبود از رندم استفاده کن.
```
```
یک لیست خالی ایجاد میشه و پیام استارت رو چاپ میکنه.
```
#### شودتکرار می num_runners برای هر دونده تعداد دوندگان معادل for حلقه : عملکرد

#### .

#### شود. این استفاده می runners برای انتخاب و حذف اولین نام از لیست runners.pop( 0 ) از : انتخاب نام دونده

#### .شودشود و بلافاصله از لیست حذف میبه این معنی است که نام اولین دونده از لیست گرفته می

#### :شودمیایجاد Thread برای هر دونده، یک شیء : ایجاد نخ

#### .شودبه عنوان تابعی که نخ اجرا خواهد کرد، مشخص می runner تابع target=runner

#### ها به به عنوان آرگومان delays و تأخیر مربوطه از لیست name پارامترهای args=(name, delays[i])

#### .شودمنتقل می runner تابع

#### .به آخرین نخ اضافه شده اشاره دارد. - 1 کندروع مینخ ایجاد شده را ش: threads[- 1 ].start() شروع نخ


##### خروجی:

##### اسم اون میاد.من اومدم تو این سناریو لیست نتایج رو بر عکس کردم یعنی اونه که اول شده به عنوان اخرین نفر سناریو دوم:


#### .رسنددوندگان با تأخیرهای تصادفی به خط پایان می: سازی مسابقهشبیه

#### .سازی دوندگانبرای همگام Barrier ز استفاده ا

#### به خط پایان زودتر Huey شود. به این ترتیب، اگر ترتیب نتایج به صورت معکوس بازگردانده می: معکوس کردن نتایج

#### .از بقیه رسید، در انتهای لیست نتایج قرار خواهد گرفت

#### ، ترتیب رسیدن دوندگان به خط پایان را به نوعی دهد و با معکوس کردن نتایجسازی را انجام میاین کد به خوبی شبیه

#### .دهد که نتایج به شکل معکوس برگردانده شوندنمایش می



اینجا عملیات را معکوس میکنه و اونی که اول هست به اخر لیست اضافه میشه. result[::- 1 ] جای که نوشته


##### سناریو سوم:

#### : سازی مسابقهشبیه

#### .کنندکند که چندین دونده با تأخیرهای تصادفی در یک مسابقه شرکت میسازی میاین کد شبیه 

#### شود، که ، ترتیب شروع دوندگان تصادفی میrandom.shuffle(runners)با استفاده از : چیدمان تصادفی 

#### .کندتری کمک میسازی طبیعیبه شبیه

##### د باشد، به ویژه زمانی که نیاز به بررسی رفتار در سازی سناریوهای مختلف مسابقات مفیتواند برای تست یا شبیهاین کد می

##### .زمانی وجود داردشرایط تصادفی یا مدیریت هم




#### خروجی:


Process-Based Parallelism


##### توی این سناریو خروجی که خواسته شده رو ایجاد کرده ایم مطابق با خروجی تمرین می باشد. سناریو اول :

```
:myFuncتابع تعریف
```
#### .شماره پردازش i

#### .های تولید شده توسط پردازشبرای ذخیره خروجی output

#### : عملکرد

#### .دهدکند که شماره پردازش را نشان میایجاد می (output_str) یک رشته

#### .کندهایی تولید می، خروجیiدر یک حلقه تا عدد

#### .دهدقرار می output در نهایت، رشته خروجی را در


#### تا اجرا میشه و فرایند فرزند تا یکی 5 توی این کد ما یک فرایند والد داریم و یک فرایند فرزند که فرایند والد تا

#### کتر از والد اجرا میشن.

#### خروجی:





##### کاهش دادم که تعداد خروجی کمتر می شود 4 به 6 توی این سناریو تعداد رو از سناریو دوم:



##### این سناریو اومدم خروجی رو کامل به صورت رندم کردم که هم والد و هم فرزندان کامل رندم شده اند توی سناریو سوم:

##### و خروجی رندمی در هر مرحله اجرا نمایش میدهند.

random.shuffle(results)

```
با استفاده از این خروجی رو رندم کرده ام.
```
##### خروجی:




#### تمرین دوم:


#### رو اختصاص دادم ولی به اخری ندادم. nameریو اول: توی این سناریو اومدم به پراسس اول سنا

#### لیستی اشتراکی output_list زمان خواب و : sleep_time پذیرداین تابع دو آرگومان می myFunc : تعریف تابع

#### هابرای ذخیره خروجی

#### دریافت multiprocessing.current_process().name از نام فرآیند جاری با استفاده : دریافت نام فرآیند

#### .شودمی


#### نام فرآیند" است. این پیام به "Starting ایجاد شده و شامل پیام output_str یک رشته به نام : ثبت پیام شروع

#### .شوداضافه می output_list

#### .ابدخومشخص شده است، می sleep_time فرآیند برای مدتی که در : زمان خواب

#### نام فرآیند" "Exiting ایجاد شده و شامل پیام output_str پس از بیدار شدن، یک رشته جدید به نام : ثبت پیام خروج

#### .شوداضافه می output_list است. این پیام نیز به

#### ها ک گذاری دادهشود که امکان اشتراایجاد می (multiprocessing.Manager) یک مدیر فرآیند: ایجاد مدیر فرآیندها

#### .کندبین فرآیندها را فراهم می

#### شود که برای ذخیره با استفاده از مدیر فرآیند ساخته می (output_list) یک لیست اشتراکی: ایجاد لیست اشتراکی

#### .شودهای فرآیندها استفاده میخروجی

#### را با myFunc ود که تابع شتعریف می myFunc یک فرآیند با نام : تعریف و شروع فرآیند با نام مشخص

#### .کندکند. سپس این فرآیند شروع به کار میفراخوانی می output_list و 3 زمان خواب های آرگومان


#### را با myFunc شود که تابع یک فرآیند دیگر بدون نام مشخص تعریف می: فرضتعریف و شروع فرآیند با نام پیش

#### .کندکند. سپس این فرآیند نیز شروع به کار میفراخوانی می output_list و 1 زمان خواب های آرگومان

#### خروجی:

```
رو داده ام. nameتوی این سناریو اومدم به هر دو فرایند مقدار سناریو دوم:
```

##### خروجی :


##### و همچنین یه فرایند دیگه نن :اومدم توی این سناریو گفته ام هر کدوم از پراسس ها استارت بشن و پیام خروج رو چاپ ک سناریو سوم

```
را نمی گیرد. nameاضافه کردم که مقدار
```

##### خروجی:


##### تمرین سوم:


که پرینت برای دو پراسس عمل کند قرار داده ام falseتوی این سناریو اومدم مقدار دایمنت را برا هردو مقدار **سناریو اول:**
.صورت کامل چاپ میشن



##### دم یه حلقه قرار دادم که مقدار اجرای خودش رو از پراسس ها میگیرد و چون از دایمنت استفاده کردم و ان را فالز هستش مقدار اوم

##### هر دو پراسس برای چاپ فرستاده میشه.

##### خروجی:



##### چاپ نشه. توی این سناریو اومدم مقدار دایمنت را برای برای اولی ترو کردم که مقدار های آن سناریو دوم :


##### خروجی:


##### توی این مقدار دایمنت را برای دومی ترو کرده ام که اجرا نشود. سناریو سوم:


شود تا از اتمام کامل ها پیوسته میهستند) به آنdaemon=False در اینجا، فرآیندهای غیر دایمون (که توی قسمت جوین اون :
شوند و ممکن است پیش از پایان کار متوقف در این مرحله پیوسته نمی (daemon=True) ها مطمئن شوید. فرآیندهای دایمونآن
.شوند


##### خروجی:

##### تمرین چهارم:


##### همان خروجی که ازم خواسته شده رو انجام داده ام. این سناریو دقیقا سناریو اول:توی

##### ا اتمام و پیوستن به آن، و طول عمر آن بررسی کنید، از شروع تهای مختلف یک فرآیند را در دهد تا وضعیتاجازه می مااین کد به

##### .دهدیک نمای کلی از نحوه کار فرآیندها را می مابه

```
:fooتابع
```
#### هایی از جمله طور متوالی، پیامبه 9 تا 0 از for سپس، درون یک حلقه .کنداین تابع پیامی مبنی بر شروع تابع چاپ می

#### کنددر پایان، پیامی مبنی بر پایان تابع چاپ می. کندثانیه توقف می 1 کند و هر بار به مدت مقادیر شمارنده چاپ می

#### :get_process_infoتابع

#### .گرداندرا برمی (p) این تابع یک رشته نمایشی از وضعیت یک شیء فرآیند

#### .شودفرآیند را شامل می (exitcode) و کد خروجی (pid) ز شناسه فرآیندنمایشی ا


```
: before_execution
```
```
(initial).نمایش وضعیت فرآیند قبل از شروع
```
.برای بررسی اینکه آیا فرآیند در حال حاضر زنده است یا خیر p.is_alive()

```
: Running
```
```
(started).نمایش وضعیت فرآیند پس از شروع
```
```
.بررسی اینکه آیا فرآیند هنوز زنده است
```
```
: Terminated
```
```
.نمایش وضعیت فرآیند بعد از مدتی پس از شروع، پیش از ترمینیشن
```
```
.بررسی اینکه آیا فرآیند هنوز زنده است
```
```
: Joined
```
```
(stopped[SIGTERM]).نمایش وضعیت فرآیند بعد از پیوستن
```

```
.بررسی اینکه آیا فرآیند هنوز زنده است
```
```
: exit_code
```
```
.کد خروجی فرآیند پس از اتمام کار آن
```
##### خروجی:

##### توی این سناریو اومدم جوری اون رو طراحی کردم که اولی فاز باشد دومی ترو و سومی فالز را نمایش دهد و اخری سناریو دوم:

##### ه ترمینیت کن خاتمه به ان بده .که خروجی هم فالز را نمایش دهد.یعنی بهش گفتم فرایند که استارت شد و زنده شد بیا اونو بلا فاصل

##### متفاوت تولید می شود.


##### خروجی:


. این {p} هم به آن اضافه کردم باستفاده از nameو رو هم اضافه کرده ام pidتوی این خروجی اومدم مقدار **سناریو سوم:**

```
{p} ، مثل یم کنای چاپ میلب رشتهرا در قا multiprocessing.Process ای از کلاس در پایتون، وقتی شیءتوضیح:
شود. این نمایشی از اطلاعات داخلی شیء است که شامل نمایش داده میما در یک قالب رشته، نمایشی از وضعیت شیء فرآیند به
.، و وضعیت فرآیند است (pid)، شناسه فرآیند (name)نام
```
```
چیه: Pid
```
یک عدد منحصر. PID شودمدرن برای شناسایی و مدیریت فرآیندها استفاده میهای عاملدر سیستم Process ID یا PID شناسه فرآیند
کند تا بتوانند به طور ها کمک میعامل و سایر برنامهشود و به سیستمعامل اختصاص داده میبه فرد است که به هر فرآیند در سیستم
.ها تعامل داشته باشنددقیق فرآیندها را شناسایی کنند و با آن

##### خروجی:


##### تمرین پنجم:

##### توی این سناریو خروجی که ازم خواسته شده رو تولید کرده ام به صورت جیسون. سناریو اول:


را ما نداریم initاشاره میکند.تابع runایجاد می شود که برای اجرا به multi processing.processتوضیح: یک زیر کلاس از
رو داریم. runفاده میکند ما اینجا فقط و ساب کلاس است initاینجا از

##### خروجی:



##### توی این سناریو اومدم خروجی رو معکوس کرده ام از بزرگ به کوچیک نمایش میده خروجی رو. سناریو دوم:


##### خروجی:



##### اومدم اول زوج هارو نمایش دادم بعد فرد هارو توی این سنارو. سناریو سوم:



##### رار دادم که اول زوج هارو بهم نمایش میده بعد فرد هارو.اومدم یه حلقه ق

##### خروجی:




##### تمرین هفتم:

##### توی این سناریو من گفتم زمان دقیق که فرایند ها به مانع می رسن رو بهم بده دوتای اولی مانع دارن که زمان دقیق رو سناریو اول:

ان هارو می اید فالز قرار میدهد یعنی مانعی برای ان ها وجود barrier_cross_timeمقدار ندارن بهم میده و دوتای اخری که مانع
ندارد.

```
گفتم که اجازه serializerفرایند های اول و دوم به این رجوع میکنن توی قسمت توی این تابع مال اونای هستش که مانع دارن
```
#### زمان ورود فرآیند به barrier_cross_time ه توی بدنه آن اومدم اجرای هم زمان ندارند به ترتیب اجرا شوند ک

#### هم زمان خاتمه فرایند است که چون خیلی نزدیکه برا فرایند ها یه تایم در نظر finish timeمی باشد .قسمت Barrier.

#### کند. هم ترو می باشد یعنی فرایند از بریر استفاده می has barrierمیگیره سیستم به صورت خودکار و


##### این تابع برای اونای هستش که از مانع استفاده نمی کنند مواردی که برای مانع بود اینجا وجود ندارن.

رو روی دو فرایند قرار دادم چون فقط دو فرایند از مانع دارد استفاده می کند. synchronizer = Barrier( 2 ) **اینجا اومدم**


##### می باشد که به ترتیب اونارو مرتب میکند این قسمت از کد برای جمع اوری نتایج

##### خروجی:



p 1 یعنی سه و چهار پس توی این سناریو فرایند های توی تین سناریو اومدم مانع رو برای دو فرایند اخری قرار دادم **سناریو دوم:**
خارج می شوند. p 4 وp 3 هر چون مانع ندارند زود تر از فرایند p 2 و




##### خروجی:


##### توی این سناریو اومدم یه فرایند دیگه اضافه کردم که اونم از مانع استفاده میکنه الان دیگه سه فرایند از مانع استفاده می سناریو سوم:

##### کنند.



##### خروجی:



##### تمرین ششم:


##### م که داده های ورودی رو ضرب با هم باشه بهش گفت 100 توی این سناریو گفتم که رنج داده های ورودی بین یک تا سناریو اول:

```
و خروجیش به صورت جیسون در اینسمنیا نمایش داده شود. result = data * dataکن
```
#### .کندیک استخر فرآیند با چهار فرآیند (پروسس) ایجاد می multiprocessing.Pool(processes= 4 )

#### را به طور موازی بر روی تمام عناصر function_square تابع pool.map(function_square, inputs)

#### .گرداندبرمی (pool_outputs) هاکند و نتایج را به صورت لیستی از خروجیاعمال میinputs لیست

#### .شودبه طور خودکار بسته می(Pool) استخر فرآیندها پس از انجام محاسبات،

#### .کندایجاد می 99 تا 0 لیستی از اعداد صحیح از inputs = list(range( 0 , 100 ))

#### کند تا مربع تمام را فراخوانی میcalculate_squares تابع results = calculate_squares(inputs)

#### .را به طور موازی محاسبه کندinputs اعداد لیست

#### به عنوان خروجی results نتایج محاسبه شده را در قالب دیکشنری با کلید return {"results": results}

#### .گرداندبرمی


#### خروجی:




##### رسوندم که خروجی متفاوت تولید کنه. 3 توی این سناریو اومدم ورودی هارو به توان سناریو دوم:


##### خروجی:





##### تغیر دادم و اومدم داده های ورودی با هم ضرب کردم دوباره 50 توی این سناریو اومدم تعداد یا رنج ورودی رو به سناریو سوم:

##### .کلا اعداد نمایش داده شده در خروجی متفاوت میشنکردم با همون ورودی اولیه که با این کار جمعش


##### خروجی:




##### مراحل داکرایز کردن کد ها

کد کد های Dockerfileداریم یه docker-compose.ymlتصاویری که قرار می دهیم مبنی بر داکرایز کردن کد ها می باشد ما یه
این فایل هارو ما داریم. requirements.txtن ها قرار دارد .و یک فایل ما در ا


##### محتوای داکر فایل می باشد


می باشد docker-compose.ymlمحتوای


##### با موفقیت انجام شده


##### با اینسمنیا هم تستش کردم

##### حالا برای پوش روی گیت هاب


##### این تصویر گیت هاپ می باشد


##### نم پوش روی سرور می باشدای


##### اینم تست می باشد که ازش گرفتم

##### پایان پردازش موازی


# داه های حجیم

## تمرین اول

## import io

## import sys

## import numpy as np

## import pickle

## from fastapi import File, UploadFile, APIRouter

## from PIL import Image

## import tensorflow as tf

## from tensorflow.keras import layers, models

##### .شوندها، ساخت مدل یادگیری عمیق، و ساخت سرویس وب وارد میهای مورد نیاز برای کار با دادهدر این بخش، کتابخانه


## sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')

##### .شودبرای پشتیبانی از کاراکترهای غیر انگلیسی استفاده می UTF- 8 خروجی به صورتاین خط برای تنظیم

## router = APIRouter()

#### دهدرا می API شود که به ما امکان تعریف مسیرهایایجاد می APIRouter یک

## def load_local_data():

## path = 'C:\\Users\\azadi\\cifar- 10 - batches-py\\'

## train_images, train_labels = [], []

## for i in range( 1 , 6 ):

## with open(f'{path}data_batch_{i}', 'rb') as file:

## batch = pickle.load(file, encoding='latin 1 ')

## train_images.append(batch['data'])

## train_labels.append(batch['labels'])

## train_images = np.concatenate(train_images)

## train_labels = np.concatenate(train_labels)

## train_images = train_images.reshape(( 50000 , 3 , 32 ,

## 32 )).transpose(0, 2, 3, 1)

## train_labels = np.array(train_labels)

## with open(f'{path}test_batch', 'rb') as file:


## batch = pickle.load(file, encoding='latin 1 ')

## test_images = batch['data']

## test_labels = batch['labels']

## test_images = test_images.reshape(( 10000 , 3 , 32 , 32 )).transpose( 0 ,

## 2 , 3 , 1 )

## test_labels = np.array(test_labels)

## return (train_images, train_labels), (test_images, test_labels)

##### خواند و سپس های آموزشی و آزمایشی را میکند. تصاویر و برچسبهای محلی بارگذاری میرا از فایل CIFAR- 10 هایاین تابع داده

##### .آوردیری عمیق در میآنها را به شکل مناسبی برای استفاده در مدل یادگ

## (train_images, train_labels), (test_images, test_labels) =

## load_local_data()

##### .شوندهای آموزشی و آزمایشی بارگذاری میداده

## train_images, test_images = train_images / 255.0, test_images / 255.0

##### شوندزی میسانرمال 1 تا 0 ها به بازه مقادیر پیکسل

## model = models.Sequential([

## layers.Conv 2 D( 32 , ( 3 , 3 ), activation='relu', input_shape=( 32 , 32 , 3 )),


## layers.MaxPooling 2 D(( 2 , 2 )),

## layers.Conv 2 D( 64 , ( 3 , 3 ), activation='relu'),

## layers.MaxPooling 2 D(( 2 , 2 )),

## layers.Conv 2 D( 64 , ( 3 , 3 ), activation='relu'),

## layers.Flatten(),

## layers.Dense( 64 , activation='relu'),

## layers.Dense( 10 )

## )]

```
های چگال، و لایه (MaxPooling 2 D)پولینگهای ماکس، لایه (Conv 2 D)های کانولوشنمدل یادگیری عمیق با استفاده از لایه
.شودساخته می(Dense)
```
## model.compile(optimizer='adam',

## loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),

## metrics=['accuracy'])

```
.شودکامپایل می SparseCategoricalCrossentropy و تابع خطای Adam سازمدل با استفاده از بهینه
```
## model.fit(train_images, train_labels, epochs=10,

## validation_data=(test_images, test_labels))

```
های آزمایشی برای اعتبارسنجی استفاده شود و از دادههای آموزشی آموزش داده میبر روی داده (epochs) دوره 10 مدل به مدت
.کندمی
```

## def preprocess_image(image):

## image = image.resize(( 32 , 32 ))

## image = np.array(image) / 255.0

## image = np.expand_dims(image, axis= 0 )

## return image

```
کند، و به شکل مناسب برای مدل سازی میدهد، آن را نرمالتغییر اندازه می 32 x 32 این تابع یک تصویر ورودی را به سایز
.آورددرمی
```
```
router.post("/predict")@
```
```
async def predict(file: UploadFile = File(...)):
```
```
ریو پردازش تصو افتی# در
```
```
image = Image.open(io.BytesIO(await file.read()))
```
```
image = preprocess_image(image)
```
##### برچسب ینیبشی# پ

```
predictions = model.predict(image)
```
```
predicted_class = np.argmax(predictions[ 0 ])
```
```
return {"label": class_names[predicted_class]}
```
##### بینی کند، و سپس با استفاده از مدل، کلاس تصویر را پیشکند، آن را پردازش مییک تصویر را از کاربر دریافت می API این مسیر

##### .گرداندکند و نام کلاس را به عنوان خروجی برمیمی

### گیرینتیجه

#### سازد و آن را در یک سرویس می CIFAR- 10 ک مدل یادگیری عمیق را برای تشخیص تصاویر از مجموعه دادهاین کد ی

#### .بندی کندکند تا تصاویر ورودی کاربران را دستهسازی میپیاده FastAPI وب با استفاده از


#### مرحله اموزش مدل:

#### خروجی:


##### تمرین دوم

from fastapi import APIRouter, FastAPI, File, UploadFile, Response

import numpy as np

import matplotlib.pyplot as plt

import tensorflow as tf

from tensorflow import keras

import tensorflow_datasets as tfds


import io

from PIL import Image

import logging

import os

import sys

#### :شوندهای مورد نیاز وارد میتابخانهدر این بخش، ک

#### .برای ساخت سرویس وبfastapi 

#### .های عددیبرای پردازش دادهnumpy 

#### .برای ترسیم و نمایش نمودارها و تصاویرmatplotlib 

#### .برای ساخت و آموزش مدل یادگیری عمیقkeras و tensorflow 

#### .هابرای بارگذاری دادهtensorflow_datasets 

#### .های باینریبا دادهبرای کار io 

#### .برای پردازش تصویرPIL 

#### .هابرای ثبت لاگlogging 

#### .برای عملیات مربوط به سیستمsys و os 

sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')

```
.شودتنظیم می (stdout) در خروجی استاندارد UTF- 8 این خط برای پشتیبانی از کاراکترهای
```
logging.basicConfig(

level=logging.INFO,

format='%(asctime)s - %(levelname)s - %(message)s',

handlers=[logging.StreamHandler(sys.stdout)]

)

logger = logging.getLogger(__name__)

##### نظیم شده و فرمت لاگ به صورت زمان و سطح لاگ ت INFO تنظیمات لاگینگ برای ثبت اطلاعات و خطاها در کنسول. سطح لاگ

##### .است


##### NUM_CLASSES = 4

##### INPUT_HEIGHT = 128

##### INPUT_WIDTH = 128

LEARNING_RATE = 1e- 3

EPOCHS = 10

BATCH_SIZE = 16

SHUFFLE = True

MODEL_WEIGHTS_FILE = 'fcn32s_model.weights.h5'

AUTOTUNE = tf.data.AUTOTUNE

##### های ها، اندازه بچ، و نام فایل وزنها، ابعاد ورودی تصاویر، نرخ یادگیری، تعداد اپوکها شامل تعداد کلاسدل و دادهتنظیمات برای م

##### .مدل

(train_ds, valid_ds, test_ds) = tfds.load(

oxford_iiit_pet","

split=["train[:85%]", "train[85%:]", "test"],

batch_size=BATCH_SIZE,

shuffle_files=SHUFFLE,

)

```
شود و به سه مجموعه آموزشی، بارگذاری میtensorflow_datasets از oxford_iiit_pet های مجموعه داده
و train_ds, valid_ds, شوند و به ترتیب در ها به صورت بچ بارگذاری میشود. دادهاعتبارسنجی و آزمایشی تقسیم می
.شوندذخیره میtest_ds
```
def unpack_resize_data(section):

image = section["image"]

segmentation_mask = section["segmentation_mask"]

resize_layer = keras.layers.Resizing(INPUT_HEIGHT, INPUT_WIDTH)

image = resize_layer(image)

segmentation_mask = resize_layer(segmentation_mask)


return image, segmentation_mask

train_ds = train_ds.map(unpack_resize_data, num_parallel_calls=AUTOTUNE)

valid_ds = valid_ds.map(unpack_resize_data, num_parallel_calls=AUTOTUNE)

test_ds = test_ds.map(unpack_resize_data, num_parallel_calls=AUTOTUNE)

```
شود. این تابع به استفاده می segmentation هایبرای تغییر اندازه تصاویر و ماسکunpack_resize_data تابع
.ها به اندازه ورودی مدل تنظیم شوندشود تا دادهی آموزشی، اعتبارسنجی و آزمایشی اعمال میهای دادهمجموعه
```
input_layer = keras.Input(shape=(INPUT_HEIGHT, INPUT_WIDTH, 3))

vgg_model = keras.applications.VGG19(include_top=False, weights="imagenet",
input_shape=(INPUT_HEIGHT, INPUT_WIDTH, 3))

fcn_backbone = keras.models.Model(

inputs=vgg_model.input,

outputs=[

vgg_model.get_layer(block_name).output

for block_name in ["block 3 _pool", "block 4 _pool", "block 5 _pool"]

,]

)

fcn_backbone.trainable = False

```
block 3 _pool, های شود. لایهاستفاده می FCN 32 s برای مدل backbone به عنوان VGG 19 در این بخش، مدل
انتخاب شده و مدل به حالت غیر قابل FCN 32 s های مدلبه عنوان خروجی VGG 19 ازblock 5 _pool و block 4 _pool,
.آیددر می (non-trainable) آموزش
```
x = fcn_backbone(input_layer)

units = [4096, 4096]

dense_convs = []


for filter_idx in range(len(units)):

dense_conv = keras.layers.Conv 2 D(

filters=units[filter_idx],

kernel_size=( 7 , 7 ) if filter_idx == 0 else ( 1 , 1 ),

strides=( 1 , 1 ),

activation="relu",

padding="same",

use_bias=False,

kernel_initializer='he_normal',

)

dense_convs.append(dense_conv)

dropout_layer = keras.layers.Dropout(0.5)

dense_convs.append(dropout_layer)

dense_convs = keras.Sequential(dense_convs)

dense_convs.trainable = False

```
مدل به حالت غیرقابل آموزش در شود. این بخش از مدل اضافه می dense هایبرای بخش Dropout های کانولوشن ودر اینجا لایه
.آیدمی
```
x = dense_convs(x[-1])

pool5 = keras.layers.Conv2D(

filters=NUM_CLASSES,

kernel_size=( 1 , 1 ),

padding="same",

strides=( 1 , 1 ),

activation="relu",

x)()


fcn32s_conv_layer = keras.layers.Conv2D(

filters=NUM_CLASSES,

kernel_size=( 1 , 1 ),

activation="softmax",

padding="same",

strides=( 1 , 1 ),

)

fcn32s_upsampling = keras.layers.UpSampling2D(

size=( 32 , 32 ),

data_format=keras.backend.image_data_format(),

interpolation="bilinear",

)

final_fcn32s_pool = pool5

final_fcn32s_output = fcn32s_conv_layer(final_fcn32s_pool)

final_fcn32s_output = fcn32s_upsampling(final_fcn32s_output)

fcn32s_model = keras.Model(inputs=input_layer, outputs=final_fcn32s_output)

```
برای افزایش اندازه خروجی به اندازه اصلی تصویر Upsampling هایبینی و لایهنهایی برای پیش های کانولوشندر اینجا، لایه
.شودساخته می FCN 32 s شود. مدلاضافه می
```
fcn32s_model.compile(

optimizer=keras.optimizers.Adam(learning_rate=LEARNING_RATE),

loss="sparse_categorical_crossentropy",

metrics=["accuracy"],

)


if os.path.exists(MODEL_WEIGHTS_FILE):

fcn 32 s_model.load_weights(MODEL_WEIGHTS_FILE)

logger.info(f"Model weights loaded from {MODEL_WEIGHTS_FILE}")

else:

fcn 32 s_model.fit(

train_ds,

validation_data=valid_ds,

epochs=EPOCHS,

)

fcn 32 s_model.save_weights(MODEL_WEIGHTS_FILE)

logger.info(f"Model weights saved to {MODEL_WEIGHTS_FILE}")

test_loss, test_accuracy = fcn32s_model.evaluate(test_ds)

logger.info(f"Test Loss: {test_loss}")

logger.info(f"Test Accuracy: {test_accuracy}")

##### شود. در غیر این صورت، مدل آموزش داده های مدل بارگذاری میها وجود داشته باشد، وزنشود و اگر فایل وزنمدل کامپایل می

##### .شودشود. همچنین دقت و خطای تست مدل محاسبه و ثبت میها ذخیره میشود و وزنمی

router.post("/predict 1 /")@

async def predict(file: UploadFile = File(...)):

image = Image.open(file.file).convert("RGB")

image = image.resize((INPUT_WIDTH, INPUT_HEIGHT))

image = np.array(image)

image = image / 255.0

image = np.expand_dims(image, axis= 0 )

prediction = fcn 32 s_model.predict(image)[ 0 ]

segmentation_mask = np.argmax(prediction, axis=- 1 )


plt.figure(figsize=( 10 , 5 ))

plt.subplot( 1 , 2 , 1 )

plt.title("Input Image")

plt.imshow(image[ 0 ])

plt.subplot( 1 , 2 , 2 )

plt.title("Segmentation Mask")

plt.imshow(segmentation_mask, cmap="inferno")

buf = io.BytesIO()

plt.savefig(buf, format='png')

plt.close()

buf.seek( 0 )

return Response(content=buf.getvalue(), media_type="image/png")

```
، و ارسال segmentationبینی نقشهبرای دریافت تصویر ورودی از کاربر، پردازش آن، پیش API (/predict 1 /) این مسیر
شود و به عنوان پاسخ به در یک نمودار نمایش داده می segmentation شود. تصویر و نقشهنتیجه به صورت تصویر استفاده می
.شودکاربر ارسال می
```
##### داکرابز کردن پروژه:


requirements.txtمحتوای فایل


##### محتوای داکر فایل


##### محتوای داکر کامپوز


ب


## باموفقیت کانتینر ها تولید شده اند

##### که با موفقیت انجام شد. سرور گیت و پوش کردن روی ریپازیتوری رو ایجاد کردیم برای بر روی گیت هاپ ما



##### اینم از پوش رو سرور


# خروجی اینسمنیا


